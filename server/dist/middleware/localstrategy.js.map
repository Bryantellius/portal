{"version":3,"file":"localstrategy.js","sourceRoot":"","sources":["../../middleware/localstrategy.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,wDAAgC;AAChC,oEAA2C;AAC3C,0DAAkC;AAClC,2DAA8D;AAE9D,kBAAQ,CAAC,aAAa,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;AACzD,kBAAQ,CAAC,eAAe,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;AAE3D,kBAAQ,CAAC,GAAG,CACV,IAAI,wBAAa,CAAC,QAAQ,CACxB,EAAE,aAAa,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,EAC1C,CAAO,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,EAAE;IAC9B,IAAI;QACF,IAAI,IAAI,GAAQ,MAAM,gBAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YACxC,KAAK,EAAE;gBACL,KAAK,EAAE,KAAK;aACb;YACD,OAAO,EAAE,CAAC,gBAAM,CAAC,IAAI,CAAC;SACvB,CAAC,CAAC;QACH,IAAI,IAAI,IAAI,CAAC,MAAM,2BAAe,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE;YAC5D,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;SAClB;aAAM;YACL,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;SACnB;KACF;IAAC,OAAO,KAAK,EAAE;QACd,IAAI,CAAC,KAAK,CAAC,CAAC;KACb;AACH,CAAC,CAAA,CACF,CACF,CAAC","sourcesContent":["import passport from \"passport\";\nimport LocalStrategy from \"passport-local\";\nimport models from \"../db/models\";\nimport { comparePassword } from \"../utils/security/passwords\";\n\npassport.serializeUser((user, next) => next(null, user));\npassport.deserializeUser((user, next) => next(null, user));\n\npassport.use(\n  new LocalStrategy.Strategy(\n    { usernameField: \"email\", session: false },\n    async (email, password, next) => {\n      try {\n        let user: any = await models.User.findOne({\n          where: {\n            email: email\n          },\n          include: [models.Role]\n        });\n        if (user && (await comparePassword(password, user.password))) {\n          next(null, user);\n        } else {\n          next(null, false);\n        }\n      } catch (error) {\n        next(error);\n      }\n    }\n  )\n);"]}